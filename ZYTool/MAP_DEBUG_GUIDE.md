# 地图定位工具调试指南

## 问题排查步骤

### 1. 检查浏览器控制台

打开浏览器开发者工具（F12），查看Console标签页的日志输出：

#### 正常情况下应该看到：
```
开始加载高德地图...
高德地图API加载成功 {Map: ƒ, ...}
开始初始化地图容器...
地图加载完成
```

#### 如果看到错误：
- `高德地图API加载失败` - 网络问题或API Key无效
- `Geocoder插件未加载` - 插件加载失败
- `地图或AMap未初始化` - 地图初始化失败

### 2. 检查网络请求

在开发者工具的Network标签页中：

1. 查找 `webapi.amap.com` 的请求
2. 确认请求状态是否为 200
3. 查看响应内容是否正常

### 3. 测试地址搜索

#### 推荐测试地址：
- `北京市天安门` - 著名地标
- `上海市东方明珠` - 著名地标
- `广州市广州塔` - 著名地标
- `深圳市腾讯大厦` - 企业地址
- `杭州市西湖` - 风景区

#### 搜索时查看控制台输出：
```
开始搜索地址: 北京市天安门
Geocoder创建成功，开始查询...
地址搜索结果: {status: "complete", result: {...}}
解析到坐标: {longitude: 116.397428, latitude: 39.90923, address: "..."}
```

### 4. 测试经纬度输入

#### 推荐测试坐标：
- 北京天安门：经度 116.397428, 纬度 39.90923
- 上海东方明珠：经度 121.499809, 纬度 31.239666
- 广州塔：经度 113.319061, 纬度 23.108386

### 5. 常见问题及解决方案

#### 问题1: 地图不显示
**可能原因：**
- API Key无效或超出配额
- 网络连接问题
- 浏览器兼容性问题

**解决方法：**
1. 检查API Key是否正确配置
2. 确认网络可以访问高德地图服务
3. 尝试使用Chrome或Edge浏览器

#### 问题2: 地址搜索失败
**可能原因：**
- Geocoder插件未加载
- 地址格式不正确
- API调用限制

**解决方法：**
1. 查看控制台是否有 "Geocoder插件未加载" 错误
2. 尝试使用更详细的地址（包含省市区）
3. 检查API调用次数是否超限

#### 问题3: 无法获取当前位置
**可能原因：**
- 浏览器权限被拒绝
- HTTP环境下定位受限
- GPS信号弱

**解决方法：**
1. 检查浏览器地址栏是否有位置权限图标
2. 使用HTTPS访问（推荐）
3. 移动到室外开阔地

#### 问题4: 地图标记不显示
**可能原因：**
- 地图未完全加载
- 坐标超出范围
- 标记创建失败

**解决方法：**
1. 等待"地图加载成功"提示后再操作
2. 确认经纬度在有效范围内
3. 查看控制台详细错误信息

## API Key配置

### 当前使用的API Key
```
82aaaef6e38ad9523d993e795b2fd05c
```

### 如何更换API Key

1. 访问高德开放平台：https://lbs.amap.com/
2. 注册并创建应用
3. 获取Web端(JS API)的Key
4. 在代码中替换：

```javascript
script.src = 'https://webapi.amap.com/maps?v=2.0&key=YOUR_NEW_KEY&plugin=AMap.Geocoder'
```

### API配额说明

免费版配额：
- 每日调用量：30万次
- 并发量：300次/秒
- QPS限制：100次/秒

## 调试技巧

### 1. 启用详细日志

代码中已经添加了详细的console.log，可以追踪：
- 地图加载过程
- 定位请求和响应
- 地址搜索过程
- 标记创建过程

### 2. 测试API连通性

在浏览器控制台执行：
```javascript
fetch('https://webapi.amap.com/maps?v=2.0&key=82aaaef6e38ad9523d993e795b2fd05c')
  .then(r => r.text())
  .then(console.log)
```

### 3. 手动测试Geocoder

在地图加载完成后，在控制台执行：
```javascript
const geocoder = new AMap.Geocoder()
geocoder.getLocation('北京市天安门', (status, result) => {
  console.log(status, result)
})
```

### 4. 检查地图实例

在控制台执行：
```javascript
console.log(window.AMap)
console.log(window.AMap.Geocoder)
```

## 性能优化建议

1. **延迟加载**：只在需要时加载地图
2. **缓存结果**：对常用地址进行缓存
3. **防抖处理**：搜索输入添加防抖
4. **错误重试**：网络失败时自动重试

## 浏览器兼容性

### 支持的浏览器
- Chrome 60+
- Firefox 60+
- Safari 12+
- Edge 79+

### 不支持的浏览器
- IE 11及以下
- 旧版本移动浏览器

## 联系支持

如果问题仍然存在：

1. 收集以下信息：
   - 浏览器版本
   - 控制台完整错误日志
   - Network请求详情
   - 复现步骤

2. 查看高德地图官方文档：
   - JS API文档：https://lbs.amap.com/api/javascript-api/summary
   - 常见问题：https://lbs.amap.com/faq

3. 检查API服务状态：
   - https://lbs.amap.com/notice
